
# 이벤트 루프
V8과 같은 자바스크립트 엔진은 단일 호출 스택(Call Stack)을 사용한다. 기본적으로 요청들은 순차적으로 처리된다. 
이벤트 루프는 요청 처리중에 실행 된다. 
<br/>
![b1493856379d11e69c16a9a4cf841567](https://user-images.githubusercontent.com/12015609/169777761-1a2f5760-9364-4815-b526-82723c6d1d34.png)
<br/>
위 그림에서 볼 수 있듯이 실제로 비동기 호출을 위해 사용되는 setTimeout()이나 XMLHttpRequest와 같은 함수들은
자바스크립트 엔진이 아닌 Web API영역에 따로 정의되어 있다. 또한 이벤트 루프와 테스크 큐와 같은 장치도 
자바스크립트 엔진 외부에 구현되어 있다. 


다음은 Node.js환경이다.

![Bt5ywJrIEAAKJQt](https://user-images.githubusercontent.com/12015609/169780200-a1914b26-7c94-47eb-b7a0-3395b5ef814e.jpg)

(출처: http://stackoverflow.com/questions/10680601/nodejs-event-loop)

이 그림에서도 브라우저의 환경과 비슷한 구조를 볼 수 있다.
잘 알려진 대로 Node.js는 비동기 IO를 지원하기 위해 libuv 라이브러리를 사용하며, 이 libuv가 이벤트 루프를 제공한다. 
자바스크립트 엔진은 비동기 작업을 위해 Node.js의 API를 호출하며, 이때 넘겨진 콜백은 libuv의 이벤트 루프를 통해 스케쥴되고 실행된다.

실제 자바스크립트가 구동되는 환경(브라우저, Node.js등)에서는 주로 여러개의 스레드가 사용되며, 이러한 구동 환경이 단일 호출스택을 
사용하는 자바 스크립트 엔진과 상호 연동하기 위해 사용하는 장치가 바로 '이벤트 루프'인 것이다.


## 태스크 큐와 이벤트 루프
태스크 큐는 말 그대로 콜백 함수들이 대기하는 큐(FIFO) 형태의 배열이라 할수 있다. 이벤트 루프는 호출 스택이 비워질 때마다 큐에서 콜백 함수를 꺼내와서 실행하는 역할을 해준다.

- 모든 비동기 API들은 작업이 완료되면 콜백 함수를 태스크 큐에 추가한다.
- 이벤트 루프는 '현재 실행중인 태스크가 없을 때'(주로 호출 스택이 비워졌을때) 태스크 큐의 첫번째 태스크를 꺼내와 실행한다.

![eventloop](https://user-images.githubusercontent.com/12015609/169938181-5d3123c1-597b-455e-91f6-df12c56519df.jpg)

(출처: http://www.2ality.com/2014/09/es6-promises-foundations.html)





참고 : https://meetup.toast.com/posts/89

